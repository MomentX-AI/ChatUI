<template>
  <div class="memory-test">
    <div class="test-header">
      <h3>ğŸ§  è¨˜æ†¶åŠŸèƒ½æ¸¬è©¦</h3>
      <button @click="isExpanded = !isExpanded" class="toggle-btn">
        {{ isExpanded ? 'æ”¶èµ·' : 'å±•é–‹' }}
      </button>
    </div>
    
    <div v-if="isExpanded" class="test-content">
      <p class="test-description">
        é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä¾†æ¸¬è©¦ AI çš„å°è©±è¨˜æ†¶åŠŸèƒ½ã€‚å»ºè­°æŒ‰é †åºåŸ·è¡Œæ¸¬è©¦ï¼š
      </p>
      
      <div class="test-steps">
        <div class="test-step">
          <h4>æ­¥é©Ÿ 1: å»ºç«‹åŸºæœ¬ä¿¡æ¯</h4>
          <div class="test-buttons">
            <button @click="sendTest('æˆ‘çš„åå­—æ˜¯å¼µå°æ˜ï¼Œæˆ‘ä»Šå¹´ 28 æ­²')" class="test-btn">
              è¨­å®šå§“åå’Œå¹´é½¡
            </button>
            <button @click="sendTest('æˆ‘æ˜¯ä¸€åè»Ÿé«”å·¥ç¨‹å¸«ï¼Œå–œæ­¡å–å’–å•¡å’Œé–±è®€ç§‘æŠ€æ›¸ç±')" class="test-btn">
              è¨­å®šè·æ¥­å’Œæ„›å¥½
            </button>
            <button @click="sendTest('æˆ‘ä½åœ¨å°åŒ—ï¼Œæœ€å–œæ­¡çš„é‹å‹•æ˜¯ç±ƒçƒ')" class="test-btn">
              è¨­å®šå±…ä½åœ°å’Œé‹å‹•
            </button>
          </div>
        </div>
        
        <div class="test-step">
          <h4>æ­¥é©Ÿ 2: æ¸¬è©¦è¨˜æ†¶å›æº¯</h4>
          <div class="test-buttons">
            <button @click="sendTest('ä½ é‚„è¨˜å¾—æˆ‘çš„åå­—å—ï¼Ÿ')" class="test-btn">
              æ¸¬è©¦å§“åè¨˜æ†¶
            </button>
            <button @click="sendTest('æˆ‘çš„è·æ¥­æ˜¯ä»€éº¼ï¼Ÿ')" class="test-btn">
              æ¸¬è©¦è·æ¥­è¨˜æ†¶
            </button>
            <button @click="sendTest('æˆ‘å–œæ­¡ä»€éº¼é‹å‹•ï¼Ÿ')" class="test-btn">
              æ¸¬è©¦é‹å‹•åå¥½
            </button>
            <button @click="sendTest('èƒ½å¹«æˆ‘ç¸½çµä¸€ä¸‹ä½ çŸ¥é“é—œæ–¼æˆ‘çš„æ‰€æœ‰ä¿¡æ¯å—ï¼Ÿ')" class="test-btn">
              æ¸¬è©¦ç¶œåˆè¨˜æ†¶
            </button>
          </div>
        </div>
        
        <div class="test-step">
          <h4>æ­¥é©Ÿ 3: æ¸¬è©¦ä¸Šä¸‹æ–‡ç†è§£</h4>
          <div class="test-buttons">
            <button @click="sendTest('åŸºæ–¼æˆ‘çš„è·æ¥­èƒŒæ™¯ï¼Œæ¨è–¦ä¸€äº›é©åˆçš„æ›¸ç±')" class="test-btn">
              ä¸Šä¸‹æ–‡æ¨è–¦
            </button>
            <button @click="sendTest('è€ƒæ…®åˆ°æˆ‘çš„å±…ä½åœ°ï¼Œé€™å€‹é€±æœ«æœ‰ä»€éº¼æ´»å‹•å»ºè­°ï¼Ÿ')" class="test-btn">
              åœ°ç†ä¸Šä¸‹æ–‡
            </button>
            <button @click="sendTest('æ ¹æ“šæˆ‘å€‘ä¹‹å‰çš„å°è©±ï¼Œä½ è¦ºå¾—æˆ‘æ˜¯ä»€éº¼æ¨£çš„äººï¼Ÿ')" class="test-btn">
              å€‹æ€§åˆ†æ
            </button>
          </div>
        </div>
        
        <div class="test-step">
          <h4>æ­¥é©Ÿ 4: é•·å°è©±æ¸¬è©¦</h4>
          <div class="test-buttons">
            <button @click="fillConversation" class="test-btn special">
              ğŸš€ è‡ªå‹•å¡«å……é•·å°è©± (æ¸¬è©¦è¨˜æ†¶ç®¡ç†)
            </button>
          </div>
          <p class="test-note">
            é€™æœƒè‡ªå‹•ç™¼é€å¤šæ¢è¨Šæ¯ä¾†æ¸¬è©¦è¨˜æ†¶ç®¡ç†å’Œæ‘˜è¦åŠŸèƒ½
          </p>
        </div>
      </div>
      
      <div class="memory-status">
        <h4>ç•¶å‰è¨˜æ†¶ç‹€æ…‹</h4>
        <div v-if="contextInfo" class="status-info">
          <div class="status-row">
            <span>è¨Šæ¯æ•¸é‡:</span>
            <span>{{ contextInfo.messageCount }}</span>
          </div>
          <div class="status-row">
            <span>é ä¼° Tokens:</span>
            <span>{{ contextInfo.estimatedTokens }}</span>
          </div>
          <div class="status-row">
            <span>ç®¡ç†ç‹€æ…‹:</span>
            <span :class="{ active: contextInfo.needsManagement }">
              {{ contextInfo.needsManagement ? 'å·²å•Ÿç”¨' : 'æ­£å¸¸' }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const props = defineProps({
  contextInfo: {
    type: Object,
    default: null
  }
})

const emit = defineEmits(['send-message'])

const isExpanded = ref(false)

const sendTest = (message) => {
  emit('send-message', message)
}

const fillConversation = async () => {
  const messages = [
    'è«‹å‘Šè¨´æˆ‘äººå·¥æ™ºèƒ½çš„ç™¼å±•æ­·å²',
    'æ©Ÿå™¨å­¸ç¿’å’Œæ·±åº¦å­¸ç¿’çš„å€åˆ¥æ˜¯ä»€éº¼ï¼Ÿ',
    'ä»€éº¼æ˜¯ç¥ç¶“ç¶²çµ¡ï¼Ÿ',
    'è‡ªç„¶èªè¨€è™•ç†æœ‰å“ªäº›æŠ€è¡“ï¼Ÿ',
    'è¨ˆç®—æ©Ÿè¦–è¦ºçš„æ‡‰ç”¨ï¼Ÿ',
    'å¼·åŒ–å­¸ç¿’æ˜¯ä»€éº¼ï¼Ÿ',
    'å¤§èªè¨€æ¨¡å‹æ€éº¼è¨“ç·´ï¼Ÿ',
    'AI å€«ç†è­°é¡Œï¼Ÿ',
    'é‡å­è¨ˆç®—å° AI çš„å½±éŸ¿ï¼Ÿ',
    'Transformer æ¶æ§‹ï¼Ÿ',
    'ä½ è¨˜å¾—æˆ‘å‰›æ‰èªªçš„åŸºæœ¬ä¿¡æ¯å—ï¼Ÿ',
    'æˆ‘çš„åå­—ã€å¹´é½¡ã€è·æ¥­éƒ½æ˜¯ä»€éº¼ï¼Ÿ'
  ]
  
  for (let i = 0; i < messages.length; i++) {
    setTimeout(() => {
      sendTest(messages[i])
    }, i * 2500) // æ¯2.5ç§’ç™¼é€ä¸€æ¢è¨Šæ¯ï¼Œæ›´å¿«è§¸ç™¼æ‘˜è¦
  }
}
</script>

<style scoped>
.memory-test {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  backdrop-filter: blur(10px);
}

.test-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  user-select: none;
}

.test-header h3 {
  margin: 0;
  color: rgba(255, 255, 255, 0.9);
  font-size: 16px;
}

.toggle-btn {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 6px;
  color: rgba(255, 255, 255, 0.8);
  padding: 4px 12px;
  cursor: pointer;
  font-size: 12px;
  transition: background-color 0.2s;
}

.toggle-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

.test-content {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.test-description {
  color: rgba(255, 255, 255, 0.8);
  font-size: 14px;
  margin-bottom: 20px;
  line-height: 1.5;
}

.test-step {
  margin-bottom: 24px;
}

.test-step h4 {
  color: rgba(255, 255, 255, 0.9);
  font-size: 14px;
  margin: 0 0 12px 0;
  font-weight: 600;
}

.test-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.test-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  border-radius: 8px;
  color: white;
  padding: 8px 12px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
  flex: 1;
  min-width: 140px;
}

.test-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.test-btn.special {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  font-weight: 600;
}

.test-note {
  color: rgba(255, 255, 255, 0.6);
  font-size: 11px;
  margin-top: 8px;
  font-style: italic;
}

.memory-status {
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.memory-status h4 {
  color: rgba(255, 255, 255, 0.9);
  font-size: 14px;
  margin: 0 0 12px 0;
}

.status-info {
  background: rgba(0, 0, 0, 0.1);
  border-radius: 6px;
  padding: 12px;
}

.status-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
  font-size: 12px;
}

.status-row span:first-child {
  color: rgba(255, 255, 255, 0.7);
}

.status-row span:last-child {
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
}

.status-row span.active {
  color: #fbbf24;
}

@media (max-width: 768px) {
  .test-buttons {
    flex-direction: column;
  }
  
  .test-btn {
    min-width: auto;
    flex: none;
  }
}
</style> 